var injected=(function(){"use strict";function j(e){return e==null||typeof e=="function"?{main:e}:e}const d=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,P=d.storage.sync;function p(e){return P.get(e)}function W(e){return e!==null&&typeof e<"u"&&Object.keys(e).length>0}function v(e){var t=new Date,n=t.toUTCString();console.log(`[${n}]	${e}`)}function D(e){if(!e||typeof e!="string")return null;const t=e.trim();if(!t)return null;try{return new RegExp(t,"i")}catch{const o=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\\*/g,".*");try{return new RegExp(o,"i")}catch{return null}}}function M(e){return Array.isArray(e)?e.map(t=>D(t)).filter(t=>t!==null):[]}function H(e,t){if(!e||!Array.isArray(t)||t.length===0)return!1;const n=[e];try{const r=new URL(e);n.push(`${r.hostname}${r.pathname}`)}catch{}return t.some(r=>n.some(o=>r.test(o)))}function K(e){return Array.isArray(e)?e.filter(t=>t&&typeof t=="string"&&t.trim().length>0):[]}function z(e){const t=[],n=[];if(e.forEach((o,i)=>{try{new RegExp(o),t.push(`(?<k${i}>${o})`),n[i]=o}catch{}}),t.length===0)return null;const r=t.join("|");return{regex:new RegExp(r,"ig"),patternMap:n}}function N(e,t){const n=K(e);if(n.length===0)return[];const r=typeof t=="string"?t:"",o=new Set,i=z(n);if(!i)return[];const{regex:s,patternMap:c}=i;let a=s.exec(r);for(;a!==null;){if(a.groups){for(const w in a.groups)if(a.groups[w]!==void 0){const g=parseInt(w.substring(1),10);c[g]&&o.add(c[g])}}if(o.size===n.length)return Array.from(o);a=s.exec(r)}return Array.from(o)}function q(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t.toString()}let l=null;const V=15e4,B=200;let R=0;const f=new Map;let E=!1,k=null,h=null,m=null,u=null,_=null,C={text:"",timestamp:0};function G(){k=null}function L(e,t){const n=typeof t=="string"?t:document.body?document.body.innerText:"";return N(e,n)}async function J(){try{const t=(await p("wordspotting_website_list")).wordspotting_website_list||[],n=M(t);H(location.href,n)?(X(),le()):v("No matching allowed site. Idling.")}catch(e){console.error("Error in proceedWithSiteListCheck:",e)}}function x(){h&&"cancelIdleCallback"in window?window.cancelIdleCallback(h):h&&clearTimeout(h),h=null,m&&(m.abort(),m=null)}function y(){x(),m=new AbortController;const e=()=>Y(m.signal);"requestIdleCallback"in window?h=window.requestIdleCallback(e,{timeout:2e3}):h=setTimeout(e,300)}function X(){document.readyState==="complete"?y():window.addEventListener("load",()=>y(),{once:!0})}async function Y(e){try{if(e?.aborted||!d.runtime||!d.runtime.id)return;const t=await p(["wordspotting_word_list","wordspotting_highlight_on","wordspotting_highlight_color"]),n=t.wordspotting_word_list,r=t.wordspotting_highlight_on===!0,o=t.wordspotting_highlight_color||"#FFFF00";if(!W(n)||n.length===0){U(0),r&&$();return}const i=await oe(e);if(e?.aborted)return;const s=`${r}:${i.length}:${q(i)}`;if(s===k)return;k=s;let c=0;r?c=await Z(n,o,e):($(),c=await O(n,i)),U(c)}catch(t){console.error("Error in performScan:",t)}}async function O(e,t){let n=[];try{n=await ce(e,t)}catch(r){console.warn("Worker scan failed, falling back",r),n=L(e,t)}return n.length}async function Z(e,t,n){try{const r=ee(document.body);if(n?.aborted)return 0;const o=r.map((s,c)=>({id:c,text:s.nodeValue})),i=await Q(e,o);return n?.aborted?0:te(i,r,t)}catch(r){return console.error("Highlight scan failed:",r),O(e,document.body.innerText)}}async function Q(e,t){const n=await F();if(!n)throw new Error("Worker not available for highlighting");return new Promise((r,o)=>{const i=++R;f.set(i,{resolve:r,reject:o}),n.postMessage({type:"scan_for_highlights",id:i,keywords:e,chunks:t})})}function ee(e){const t=[];if(!e)return t;const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:o=>!o.nodeValue||!o.nodeValue.trim()||o.parentNode&&["SCRIPT","STYLE","NOSCRIPT","TEXTAREA","INPUT"].includes(o.parentNode.tagName)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT});let r=n.nextNode();for(;r;)t.push(r),r=n.nextNode();return t}function te(e,t,n){if(!("highlights"in CSS))return 0;const r=[],o=new Set;for(const[s,c]of Object.entries(e)){const a=parseInt(s,10),w=t[a];if(w)for(const g of c)try{const T=new Range;T.setStart(w,g.index),T.setEnd(w,g.index+g.length),r.push(T),o.add(g.keyword)}catch{}}const i=new Highlight(...r);return CSS.highlights.set("wordspotting-match",i),ne(n),o.size}function $(){"highlights"in CSS&&CSS.highlights.delete("wordspotting-match")}let b=null;function ne(e){b||(b=document.createElement("style"),document.head.appendChild(b)),b.textContent=`
        ::highlight(wordspotting-match) {
            background-color: ${e};
            color: black;
        }
    `}function re(e,t){let n=null;function r(...o){n&&clearTimeout(n),n=setTimeout(()=>e(...o),t)}return r.cancel=()=>{n&&clearTimeout(n),n=null},r}async function oe(e){const t=Date.now();if(t-C.timestamp<500)return C.text;if(e?.aborted)return"";const r=document.body&&document.body.innerText||"";return C={text:r,timestamp:t},r}async function F(){if(E)return null;if(l)return l;try{const e=d.runtime.getURL("/js/scan-worker.js"),t=d.runtime.getURL("/js/scanner.js"),[n,r]=await Promise.all([fetch(e),fetch(t)]),o=await n.text(),s=`${await r.text()}
${o}`,c=new Blob([s],{type:"application/javascript"}),a=URL.createObjectURL(c);return l=new Worker(a),ie(l),l}catch(e){return console.warn("Wordspotting worker creation failed (inline blob):",e),E=!0,null}}function ie(e){e.addEventListener("message",se),e.addEventListener("error",t=>{console.warn("Wordspotting worker error:",t),E=!0,I()})}function se(e){const t=e.data||{};if(typeof t.id!="number")return;const n=f.get(t.id);n&&(f.delete(t.id),t.type==="scan_result"?n.resolve(Array.isArray(t.words)?t.words:[]):t.type==="scan_highlights_result"?n.resolve(t.results||{}):t.type==="scan_error"&&n.reject(new Error(t.error||"Worker scan failed")))}function I(){l&&(l.terminate(),l=null),f.forEach(e=>{e.reject(new Error("Worker terminated"))}),f.clear()}async function ce(e,t){const n=await F();return n?new Promise((r,o)=>{const{chunkSize:i,overlap:s}=ae(t,e),c=++R;f.set(c,{resolve:r,reject:o}),n.postMessage({type:"scan",id:c,keywords:e,text:t,chunkSize:i,overlap:s})}):N(e,t)}function ae(e,t){const n=typeof e=="string"?e.length:0;let r=V,o=B;n>8e5?(r=3e5,o=400):n>3e5?(r=2e5,o=300):n>12e4&&(r=16e4,o=240);const i=Array.isArray(t)?t.reduce((s,c)=>typeof c=="string"&&c.length>s?c.length:s,0):0;return o=Math.max(o,Math.min(i,800)),{chunkSize:r,overlap:o}}function U(e){try{d.runtime.sendMessage({wordfound:e>0,keyword_count:e}).catch(()=>{})}catch{}}function le(){const e={childList:!0,subtree:!0,characterData:!0};_=re(()=>{y()},500),u=new MutationObserver(_),document.body&&u.observe(document.body,e),document.addEventListener("visibilitychange",()=>{document.hidden?(u&&u.disconnect(),x()):(document.body&&u&&u.observe(document.body,e),y())}),window.addEventListener("pagehide",()=>{u&&u.disconnect(),x(),I(),_?.cancel&&_.cancel()})}const ue=j(async()=>{if(!globalThis.__WORDSPOTTING_CONTENT_LOADED__){globalThis.__WORDSPOTTING_CONTENT_LOADED__=!0;try{const e=await p("wordspotting_extension_on");v("Checking if extension is on..."),e.wordspotting_extension_on&&J()}catch(e){console.error("Error checking extension status:",e)}d.runtime.onMessage.addListener((e,t,n)=>((async()=>{try{const o=(await p("wordspotting_extension_on")).wordspotting_extension_on;if(e.from==="popup"&&e.subject==="word_list_request"){if(!o){n({word_list:[],disabled:!0});return}const s=(await p("wordspotting_word_list")).wordspotting_word_list;if(W(s)&&s.length>0){const c=L(s);n({word_list:c})}else n({word_list:[]});return}if(e.from==="background"&&e.subject==="settings_updated"){G(),y(),n({ack:!0});return}n({})}catch(r){console.error("Error in onMessage:",r),n({word_list:[]})}})(),!0))}});function he(){}function S(e,...t){}const A={debug:(...e)=>S(console.debug,...e),log:(...e)=>S(console.log,...e),warn:(...e)=>S(console.warn,...e),error:(...e)=>S(console.error,...e)};return(()=>{try{}catch(t){throw A.error('Failed to initialize plugins for "injected"',t),t}let e;try{e=ue.main(),e instanceof Promise&&(e=e.catch(t=>{throw A.error('The unlisted script "injected" crashed on startup!',t),t}))}catch(t){throw A.error('The unlisted script "injected" crashed on startup!',t),t}return e})()})();
injected;